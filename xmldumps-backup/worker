#!/bin/bash

WIKIDUMP_BASE=`dirname "$0"`

if [ ! -z "$1" ]; then
    configFile="$1"
fi

while true; do
    if [ -e "maintenance.txt" ]; then
	echo "in maintenance mode, sleeping 5 minutes"
	sleep 300
    else
	if [ ! -z "$configFile" ]; then
	    python $WIKIDUMP_BASE/worker.py "--configfile" "$configFile"
	else
	    python $WIKIDUMP_BASE/worker.py
	fi
	echo "sleeping"
	sleep 30
    fi
done
